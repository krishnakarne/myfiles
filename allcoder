saveDiagram(xml: any): Promise<void> {
    return new Promise((resolve, reject) => {
        try {
            // Extract the Base64 encoded SVG from the XML
            const base64Data = xml.image.base64Encoded;

            if (!base64Data) {
                throw new Error('No base64 data found in the XML');
            }

            // Decode the Base64 string
            const svgData = atob(base64Data);

            // Create an image element
            const img = new Image();
            img.src = 'data:image/svg+xml;base64,' + base64Data;

            img.onload = () => {
                // Create a canvas to render the SVG
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');

                // Draw the SVG onto the canvas
                ctx.drawImage(img, 0, 0);

                // Convert the canvas to a PNG data URL
                const pngDataUrl = canvas.toDataURL('image/png');

                // Create a download link for the PNG
                const a = document.createElement('a');
                a.href = pngDataUrl;
                a.download = `${xml.name || 'diagram'}.png`; // Use the diagram name or default
                a.click();

                resolve();
            };

            img.onerror = (error) => {
                reject(new Error('Failed to load the SVG image'));
            };
        } catch (error) {
            console.error('Save failed', error);
            reject(error);
        }
    });
}
